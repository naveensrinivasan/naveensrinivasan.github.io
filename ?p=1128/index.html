<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="admin"><meta name=description content="In this post I would demonstrate how to dump strings from a memory dump /live process to a file. Recently I had to debug a process which had few big strings where I had to analyze its contents. The !dumpobj from sos would only dump partial strings. I had to dump few hundred XML strings that I had to analyze using some automation. And hence comes the script.
[sourcecode]
$$ Dumps the managed strings to a file
"><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href="/?p=1128/"><title>Dumping .NET strings to files using Windbg :: naveen srinivasan — Write code.Loves to read
</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.29c2c8c3fc9cf748254138351f142ac2833b208a68e83aec126edc98b59efef2.css><meta itemprop=name content="Dumping .NET strings to files using Windbg"><meta itemprop=description content="In this post I would demonstrate how to dump strings from a memory dump /live process to a file. Recently I had to debug a process which had few big strings where I had to analyze its contents. The !dumpobj from sos would only dump partial strings. I had to dump few hundred XML strings that I had to analyze using some automation. And hence comes the script.
[sourcecode]
$$ Dumps the managed strings to a file"><meta itemprop=datePublished content="2010-11-01T21:37:16+00:00"><meta itemprop=dateModified content="2010-11-01T21:37:16+00:00"><meta itemprop=wordCount content="348"><meta itemprop=image content="/"><meta itemprop=keywords content=".NET,Windbg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/"><meta name=twitter:title content="Dumping .NET strings to files using Windbg"><meta name=twitter:description content="In this post I would demonstrate how to dump strings from a memory dump /live process to a file. Recently I had to debug a process which had few big strings where I had to analyze its contents. The !dumpobj from sos would only dump partial strings. I had to dump few hundred XML strings that I had to analyze using some automation. And hence comes the script.
[sourcecode]
$$ Dumps the managed strings to a file"><meta property="article:section" content=".NET"><meta property="article:section" content="Windbg"><meta property="article:published_time" content="2010-11-01 21:37:16 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>cd /home</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/posts>posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href="/?p=1128/">Dumping .NET strings to files using Windbg</a></h2><div class=post-content><p>In this post I would demonstrate how to dump strings from a memory dump /live process to a file. Recently I had to debug a process which had few big strings where I had to analyze its contents. The !dumpobj from sos would only dump partial strings.  I had to dump few hundred XML strings that I had to analyze using some automation. And hence comes the script.</p><p>[sourcecode]</p><p>$$ Dumps the managed strings to a file</p><p>$$ Platform x86</p><p>$$ Naveen Srinivasan <a href=http://naveensrinivasan.com>http://naveensrinivasan.com</a></p><p>$$ Usage $$>a&lt;&ldquo;c:tempdumpstringtofolder.txt&rdquo; 6544f9ac 5000 c:tempstringtest</p><p>$$ First argument is the string method table pointer</p><p>$$ Second argument is the Min size of the string that needs to be used filter</p><p>$$ the strings</p><p>$$ Third is the path of the file</p><p>.foreach ($string {!dumpheap -short -mt ${$arg1} -min ${$arg2}})</p><p>{</p><p>$$ MT Field Offset Type VT Attr Value Name</p><p>$$ 65452978 40000ed 4 System.Int32 1 instance 71117 m_stringLength</p><p>$$ 65451dc8 40000ee 8 System.Char 1 instance 3c m_firstChar</p><p>$$ 6544f9ac 40000ef 8 System.String 0 shared static Empty</p><p>$$ start of string is stored in the 8th offset, which can be inferred from above</p><p>$$ Size of the string which is stored in the 4th offset</p><p>r@$t0= poi(${$string}+4)*2</p><p>.writemem ${$arg3}${$string}.txt ${$string}+8 ${$string}+8+@$t0</p><p>}</p><p>[/sourcecode]</p><p>And to use the above script ,copy it to a file and invoke it within Windbg/cdb</p><blockquote><p>$$>a&lt;“c:tempdumpstringtofolder.txt” 6544f9ac 5000 c:tempstringtest</p></blockquote><p>Parameters to the script</p><ol><li>6544f9ac :- Is the MT to string.</li><li>5000 :- Is the min size of the string that I want to dump</li><li>c:tempstringtest :- Is the path along with partial filename for each string item</li></ol><p>The dumped contents would be in Unicode format and to view its contents use something like this</p><p>[sourcecode language=”csharp”]</p><p>Console.WriteLine(ASCIIEncoding.Unicode.GetString(File.ReadAllBytes(@&ldquo;c:tempstringtest03575270.txt&rdquo;)));</p><p>[/sourcecode]</p><p>And here is a sample code that downloads big xml strings ,that can be used by the above script to dump its contents to a folder</p><p>[sourcecode language=”csharp”]</p><p>using System;</p><p>using System.Net;</p><p>namespace Test</p><p>{</p><p>class Program</p><p>{</p><p>static void Main(string[] args)</p><p>{</p><p>var speakers = new WebClient().DownloadString(&ldquo;<a href=http://www.codemash.org/rest/speakers%22%29;>http://www.codemash.org/rest/speakers");</a></p><p>var sessions = new WebClient().DownloadString(&ldquo;<a href=http://www.codemash.org/rest/sessions%22%29;>http://www.codemash.org/rest/sessions");</a></p><p>Console.Read();</p><p>}</p><p>}</p><p>}</p><p>[/sourcecode]</p><p>[twitter-follow screen_name=’snaveen’ show_count=’yes’ text_color=’00ccff’]</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=/categories/.net/>.NET</a></span>
<span class=tag><a href=/categories/windbg/>Windbg</a></span></p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.63e1cd4087b02bc78961fcab2aaf77e957e2227557c73ab774f1cc4a9db0645e90d2403ca03e55eb0887e432e82aea10afe7f125052af6dd46cfea148ecbc663.js integrity="sha512-Y+HNQIewK8eJYfyrKq936VfiInVXxzq3dPHMSp2wZF6Q0kA8oD5V6wiH5DLoKuoQr+fxJQUq9t1Gz+oUjsvGYw=="></script></body></html>