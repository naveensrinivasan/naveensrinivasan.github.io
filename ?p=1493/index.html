<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content="admin">
<meta name=description content="The EventSourcelibrary provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.
What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called. Ideally we would have a ability to view the duration of these events similar to ASP.">
<meta name=keywords content=",ETW">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href="/?p=1493/">
<title>
Use Eventsource to get the duration of a Start Stop of Custom ETW events :: naveen srinivasan — Write code.Loves to read
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.29c2c8c3fc9cf748254138351f142ac2833b208a68e83aec126edc98b59efef2.css>
<meta itemprop=name content="Use Eventsource  to get the duration of a Start Stop of Custom ETW events">
<meta itemprop=description content="The EventSourcelibrary provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.
What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called. Ideally we would have a ability to view the duration of these events similar to ASP."><meta itemprop=datePublished content="2015-06-08T19:53:29+00:00">
<meta itemprop=dateModified content="2015-06-08T19:53:29+00:00">
<meta itemprop=wordCount content="270"><meta itemprop=image content="/">
<meta itemprop=keywords content="ETW,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/">
<meta name=twitter:title content="Use Eventsource  to get the duration of a Start Stop of Custom ETW events">
<meta name=twitter:description content="The EventSourcelibrary provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.
What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called. Ideally we would have a ability to view the duration of these events similar to ASP.">
<meta property="article:section" content="ETW">
<meta property="article:published_time" content="2015-06-08 19:53:29 +0000 UTC">
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text>cd /home</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/posts>posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info>
</p>
</div>
<article>
<h2 class=post-title><a href="/?p=1493/">Use Eventsource to get the duration of a Start Stop of Custom ETW events</a></h2>
<div class=post-content>
<p>The EventSource library provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.</p>
<p>What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called. Ideally we would have a ability to view the duration of these events similar to ASP.NET calls.  The EventSource Library along with Perfview provides this ability to view the duration between the start and stop events.</p>
<p>Here is a code sample with CustomEvent</p>
<p>[gist https://gist.github.com/naveensrinivasan/7e54c72dc628ae7da69e]</p>
<p>And here is the output from Perfview with the duration.</p>
<p><a href=https://naveensrinivasan.files.wordpress.com/2015/06/startstopetw.jpg></a></p>
<p>How often we want to capture trace when the performance of our custom event goes down to figure out what went wrong. This is very much possible with this.</p>
<p>Here is the command</p>
<p>PerfView /StopOnEtwEvent:*CustomEvent//Start;TriggerMSec=2000 collect</p>
<p>This would record the ETW events on a flight recorder mode and would stop when the CustomEvent took more than 2 seconds. This is one of the features I really like because it is a great asset to DevOps to see when the issue arises.</p>
<p>Here is an example of Perfview Stop reason that shows why perfview stopped which clearly  indicates when the duration of event took more than 2000 milliseconds.</p>
<p><a href=https://naveensrinivasan.files.wordpress.com/2015/06/perfviewstopreason.jpg></a></p>
<p>There is a bug in perfview that would not record Stop triggered events. I have reported this and I hope this would be fixed in the next public release.</p>
<p>The source code for these samples are here</p>
<p><a href=https://github.com/naveensrinivasan/ETWSamples>https://github.com/naveensrinivasan/ETWSamples</a></p>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=/tags/etw/>ETW</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=/categories/etw/>ETW</a></span>
</p>
</div>
</main>
</div>
<footer class=footer>
</footer>
</div>
<script type=text/javascript src=/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>
</body>
</html>