<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="admin">
<meta name="description"
    content="The EventSource library provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.
What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/p1493/" />


<title>
    
    Use Eventsource  to get the duration of a Start Stop of Custom ETW events :: naveen srinivasan  — Write code.Loves to read
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.0d47b4686e972122bd29f0c1e3dd024a2d541cd8b1b543622520822ea6f4238a.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627">
<meta itemprop="name" content="Use Eventsource  to get the duration of a Start Stop of Custom ETW events">
<meta itemprop="description" content="The EventSource library provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.
What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called.">


<meta itemprop="datePublished" content="2015-06-08T19:53:29&#43;00:00" />
<meta itemprop="dateModified" content="2015-06-08T19:53:29&#43;00:00" />
<meta itemprop="wordCount" content="271">



<meta itemprop="keywords" content="ETW," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Use Eventsource  to get the duration of a Start Stop of Custom ETW events"/>
<meta name="twitter:description" content="The EventSource library provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.
What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called."/>



<meta property="article:section" content="ETW" />

<meta property="article:published_time" content="2015-06-08 19:53:29 &#43;0000 &#43;0000" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">cd /home</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts">posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="/p1493/">Use Eventsource  to get the duration of a Start Stop of Custom ETW events</a></h2>

            

            <div class="post-content">
                <p>The <a href="https://www.nuget.org/packages/Microsoft.Diagnostics.Tracing.EventSource/" target="_blank">EventSource</a> library provides an option to get duration of Custom ETW start and stop events and when used with Perfview we could leverage this to stop tracing when the duration is more than what we expect.</p>

<p>What it is for example ,there could an external API call the application makes that has to be traced with the start and when it finishes then the stop of the event is called. Ideally we would have a ability to view the duration of these events similar to ASP.NET calls.  The EventSource Library along with Perfview provides this ability to view the duration between the start and stop events.</p>

<p>Here is a code sample with CustomEvent</p>

<p>[gist <a href="https://gist.github.com/naveensrinivasan/7e54c72dc628ae7da69e">https://gist.github.com/naveensrinivasan/7e54c72dc628ae7da69e</a>]</p>

<p>And here is the output from Perfview with the duration.</p>

<p><a href="https://naveensrinivasan.files.wordpress.com/2015/06/startstopetw.jpg"><img class="alignleft wp-image-1495 size-full" src="https://naveensrinivasan.files.wordpress.com/2015/06/startstopetw.jpg" alt="StartStopETW" width="494" height="204" srcset="https://www.naveensrinivasan.com/wp-content/uploads/2015/06/startstopetw.jpg 494w, https://www.naveensrinivasan.com/wp-content/uploads/2015/06/startstopetw-300x124.jpg 300w" sizes="(max-width: 494px) 100vw, 494px" /></a></p>

<p>How often we want to capture trace when the performance of our custom event goes down to figure out what went wrong. This is very much possible with this.</p>

<p>Here is the command</p>

<p>PerfView /StopOnEtwEvent:*CustomEvent//Start;TriggerMSec=2000 collect</p>

<p>This would record the ETW events on a flight recorder mode and would stop when the CustomEvent took more than 2 seconds. This is one of the features I really like because it is a great asset to DevOps to see when the issue arises.</p>

<p>Here is an example of Perfview Stop reason that shows why perfview stopped which clearly  indicates when the duration of event took more than 2000 milliseconds.</p>

<p><a href="https://naveensrinivasan.files.wordpress.com/2015/06/perfviewstopreason.jpg"><img class="alignleft size-full wp-image-1496" src="https://naveensrinivasan.files.wordpress.com/2015/06/perfviewstopreason.jpg" alt="PerfviewStopReason" width="660" height="44" srcset="https://www.naveensrinivasan.com/wp-content/uploads/2015/06/perfviewstopreason.jpg 897w, https://www.naveensrinivasan.com/wp-content/uploads/2015/06/perfviewstopreason-300x20.jpg 300w, https://www.naveensrinivasan.com/wp-content/uploads/2015/06/perfviewstopreason-768x51.jpg 768w" sizes="(max-width: 660px) 100vw, 660px" /></a></p>

<p>There is a bug in perfview that would not record Stop triggered events. I have reported this and I hope this would be fixed in the next public release.</p>

<p>The source code for these samples are here</p>

<p><a href="https://github.com/naveensrinivasan/ETWSamples" target="_blank"><a href="https://github.com/naveensrinivasan/ETWSamples">https://github.com/naveensrinivasan/ETWSamples</a></a></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="/tags/etw">ETW</a></span>
  				</p>
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2019</span>
            
            <span></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.9e52e68b082cf2a30a7fead88260edb8818fbd7f7831e39674917d4539ec75df41ba88eaddfbd916594ab4fb2a31913b46cf2d6094cf80381edb8c632512a8ca.js" integrity="sha512-nlLmiwgs8qMKf&#43;rYgmDtuIGPvX94MeOWdJF9RTnsdd9Buojq3fvZFllKtPsqMZE7Rs8tYJTPgDge24xjJRKoyg=="></script>



    </body>
</html>
